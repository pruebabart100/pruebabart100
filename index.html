<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TPV Bar - VersiÃ³n Final</title>
    
    <style>
        :root {
            --primary-color: #2563eb;
            --food-color: #ea580c;
            --drink-color: #059669;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body { background-color: var(--bg-color); padding-bottom: 100px; } /* Espacio para el carrito */

        /* Cabecera */
        header {
            background: var(--card-bg);
            padding: 15px;
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center;
        }
        #numMesa {
            font-size: 1.2rem; padding: 5px; width: 60px;
            text-align: center; border: 2px solid var(--primary-color); border-radius: 8px;
        }

        /* PestaÃ±as */
        .tabs { display: flex; margin: 10px; gap: 10px; }
        .tab-btn {
            flex: 1; padding: 15px; border: none; border-radius: 8px;
            font-weight: bold; font-size: 1rem; color: white; cursor: pointer; opacity: 0.6;
        }
        .tab-btn.active { opacity: 1; transform: scale(1.02); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .btn-comida { background-color: var(--food-color); }
        .btn-bebida { background-color: var(--drink-color); }

        /* Rejilla Productos */
        .grid-productos {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px;
        }
        .card-producto {
            background: var(--card-bg); padding: 20px 10px; border-radius: 10px;
            text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: pointer;
            border-bottom: 4px solid transparent;
        }
        .card-producto:active { transform: scale(0.95); background-color: #e5e7eb; }
        .card-producto.tipo-comida { border-bottom-color: var(--food-color); }
        .card-producto.tipo-bebida { border-bottom-color: var(--drink-color); }
        .prod-nombre { display: block; font-weight: bold; font-size: 1.1rem; margin-bottom: 5px; }

        /* Carrito Flotante */
        #ticket-resumen {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            padding: 15px; z-index: 200; border-top-left-radius: 15px; border-top-right-radius: 15px;
        }
        .resumen-info { display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: bold; }
        .btn-enviar {
            width: 100%; padding: 15px; background-color: var(--primary-color);
            color: white; border: none; border-radius: 10px;
            font-size: 1.2rem; font-weight: bold; cursor: pointer;
        }
        .btn-enviar:disabled { background-color: #ccc; cursor: not-allowed; }

        /* Lista desplegable */
        #lista-pedidos {
            max-height: 200px; overflow-y: auto; margin-bottom: 10px;
            border-top: 1px solid #eee; padding-top: 10px; font-size: 0.9rem;
        }
        .item-pedido { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dotted #eee; }
        .btn-eliminar { color: red; font-weight: bold; margin-left: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <header>
        <div class="mesa-selector">
            <span>Mesa:</span>
            <input type="number" id="numMesa" placeholder="#" inputmode="numeric">
        </div>
        <div style="color:green; font-weight:bold;">ðŸŸ¢ Online</div>
    </header>

    <section class="tabs">
        <button class="tab-btn btn-bebida active" onclick="filtrarCategoria('bebida')">Bebidas</button>
        <button class="tab-btn btn-comida" onclick="filtrarCategoria('comida')">Comidas</button>
    </section>

    <main id="contenedor-productos" class="grid-productos">
        </main>

    <aside id="ticket-resumen">
        <div id="lista-pedidos"></div>
        <div class="resumen-info">
            <span id="contador-items">0 prod.</span>
            <span id="total-precio">0.00 â‚¬</span>
        </div>
        <button id="btn-enviar" class="btn-enviar" onclick="enviarComanda()">
            Selecciona productos
        </button>
    </aside>

    <script>
        // --- CONFIGURACIÃ“N ---
        // ðŸ‘‡ðŸ‘‡ PEGA TU URL DEL SCRIPT AQUÃ (LA QUE TERMINA EN /exec) ðŸ‘‡ðŸ‘‡
        const SCRIPT_URL = "AQUI_TU_URL_DE_APPS_SCRIPT"; 
        // ðŸ‘†ðŸ‘† REVISA QUE NO TENGA ESPACIOS AL FINAL ðŸ‘†ðŸ‘†

        const productos = [
            { id: 1, nombre: "CaÃ±a", precio: 1.50, cat: "bebida" },
            { id: 2, nombre: "Doble", precio: 2.50, cat: "bebida" },
            { id: 3, nombre: "Refresco", precio: 2.00, cat: "bebida" },
            { id: 4, nombre: "Vino", precio: 3.00, cat: "bebida" },
            { id: 5, nombre: "CafÃ©", precio: 1.20, cat: "bebida" },
            { id: 6, nombre: "Bravas", precio: 4.50, cat: "comida" },
            { id: 7, nombre: "Croquetas", precio: 6.00, cat: "comida" },
            { id: 8, nombre: "Hamburguesa", precio: 9.50, cat: "comida" },
            { id: 9, nombre: "Ensalada", precio: 7.00, cat: "comida" },
            { id: 10, nombre: "Tortilla", precio: 3.50, cat: "comida" }
        ];

        let carrito = [];

        // Inicializar
        window.onload = function() {
            console.log("App iniciada");
            filtrarCategoria('bebida'); 
            actualizarTicket();
        };

        function filtrarCategoria(cat) {
            const grid = document.getElementById('contenedor-productos');
            grid.innerHTML = '';
            
            // Estilos botones
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`.btn-${cat}`).classList.add('active');

            // Renderizar items
            productos.filter(p => p.cat === cat).forEach(prod => {
                const card = document.createElement('div');
                card.className = `card-producto tipo-${prod.cat}`;
                card.onclick = () => agregar(prod);
                card.innerHTML = `
                    <span class="prod-nombre">${prod.nombre}</span>
                    <span class="prod-precio">${prod.precio.toFixed(2)}â‚¬</span>
                `;
                grid.appendChild(card);
            });
        }

        function agregar(prod) {
            carrito.push(prod);
            actualizarTicket();
        }

        function eliminar(index) {
            carrito.splice(index, 1);
            actualizarTicket();
        }

        function actualizarTicket() {
            const lista = document.getElementById('lista-pedidos');
            const totalEl = document.getElementById('total-precio');
            const countEl = document.getElementById('contador-items');
            const btn = document.getElementById('btn-enviar');

            lista.innerHTML = '';
            let total = 0;

            carrito.forEach((item, i) => {
                total += item.precio;
                lista.innerHTML += `
                    <div class="item-pedido">
                        <span>${item.nombre}</span>
                        <div>
                            <span>${item.precio.toFixed(2)}â‚¬</span>
                            <span class="btn-eliminar" onclick="eliminar(${i})">âœ–</span>
                        </div>
                    </div>`;
            });

            totalEl.innerText = total.toFixed(2) + " â‚¬";
            countEl.innerText = carrito.length + " prod.";

            if (carrito.length > 0) {
                btn.disabled = false;
                btn.innerText = `Enviar a Cocina (${total.toFixed(2)}â‚¬) ðŸš€`;
                btn.style.opacity = "1";
            } else {
                btn.disabled = true;
                btn.innerText = "Selecciona productos";
                btn.style.opacity = "0.5";
            }
        }

        // --- FUNCIÃ“N DE ENVÃO QUE FUNCIONA (GET) ---
        function enviarComanda() {
            const mesa = document.getElementById('numMesa').value;
            if (!mesa) { alert("âš ï¸ Â¡Falta el nÃºmero de mesa!"); return; }

            const btn = document.getElementById('btn-enviar');
            btn.innerText = "Enviando...";
            btn.disabled = true;

            const datos = { mesa: mesa, carrito: carrito };
            const payload = encodeURIComponent(JSON.stringify(datos));
            const urlFinal = SCRIPT_URL + "?datos=" + payload;

            fetch(urlFinal, { method: "GET", mode: "no-cors" })
            .then(() => {
                alert("âœ… Â¡Pedido enviado correctamente!");
                carrito = [];
                actualizarTicket();
                document.getElementById('numMesa').value = ''; // Limpiar mesa opcional
            })
            .catch(err => {
                alert("âŒ Error: " + err);
            })
            .finally(() => {
                btn.disabled = false;
                actualizarTicket();
            });
        }
    </script>
</body>
</html>
