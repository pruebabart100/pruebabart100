<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TPV Bar</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <div class="mesa-selector">
            <span>Mesa:</span>
            <input type="number" id="numMesa" value="" placeholder="#" style="width:60px; text-align:center;">
        </div>
        <div id="estado-conexion">ðŸŸ¢ Online</div>
    </header>

    <section class="tabs">
        <button class="tab-btn btn-bebida active" onclick="filtrarCategoria('bebida')">Bebidas</button>
        <button class="tab-btn btn-comida" onclick="filtrarCategoria('comida')">Comidas</button>
    </section>

    <main id="contenedor-productos" class="grid-productos">
        </main>

    <aside id="ticket-resumen">
        <div id="lista-pedidos"></div>
        
        <div class="resumen-info">
            <span id="contador-items">0 productos</span>
            <span id="total-precio">0.00 â‚¬</span>
        </div>
        
        <button id="btn-enviar" class="btn-enviar" onclick="enviarComanda()">
            Selecciona productos
        </button>
    </aside>

    <script>
        // 1. CONFIGURACIÃ“N DE PRODUCTOS
        const productos = [
            { id: 1, nombre: "CaÃ±a", precio: 1.50, cat: "bebida" },
            { id: 2, nombre: "Doble", precio: 2.50, cat: "bebida" },
            { id: 3, nombre: "Refresco", precio: 2.00, cat: "bebida" },
            { id: 4, nombre: "Vino Copa", precio: 3.00, cat: "bebida" },
            { id: 5, nombre: "CafÃ©", precio: 1.20, cat: "bebida" },
            
            { id: 6, nombre: "Bravas", precio: 4.50, cat: "comida" },
            { id: 7, nombre: "Croquetas (6)", precio: 6.00, cat: "comida" },
            { id: 8, nombre: "Hamburguesa", precio: 9.50, cat: "comida" },
            { id: 9, nombre: "Ensalada", precio: 7.00, cat: "comida" },
            { id: 10, nombre: "Pincho Tortilla", precio: 3.50, cat: "comida" }
        ];

        let carrito = [];

        // 2. INICIO
        window.onload = function() {
            filtrarCategoria('bebida'); 
            actualizarTicket();
        };

        // 3. RENDERIZADO
        function filtrarCategoria(categoria) {
            const contenedor = document.getElementById('contenedor-productos');
            contenedor.innerHTML = '';
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.btn-${categoria}`).classList.add('active');

            const filtrados = productos.filter(p => p.cat === categoria);
            
            filtrados.forEach(prod => {
                const btn = document.createElement('div');
                btn.className = `card-producto tipo-${prod.cat}`;
                btn.onclick = () => agregarAlCarrito(prod);
                btn.innerHTML = `
                    <span class="prod-nombre">${prod.nombre}</span>
                    <span class="prod-precio">${prod.precio.toFixed(2)}â‚¬</span>
                `;
                contenedor.appendChild(btn);
            });
        }

        // 4. CARRITO
        function agregarAlCarrito(producto) {
            carrito.push(producto);
            actualizarTicket();
        }

        function eliminarDelCarrito(index) {
            carrito.splice(index, 1);
            actualizarTicket();
        }

        function actualizarTicket() {
            const lista = document.getElementById('lista-pedidos');
            const contador = document.getElementById('contador-items');
            const total = document.getElementById('total-precio');
            const btn = document.getElementById('btn-enviar');

            lista.innerHTML = '';
            let totalCalc = 0;

            carrito.forEach((item, index) => {
                totalCalc += item.precio;
                lista.innerHTML += `
                    <div class="item-pedido">
                        <span>${item.nombre}</span>
                        <div>
                            <span>${item.precio.toFixed(2)}â‚¬</span>
                            <span class="btn-eliminar" onclick="eliminarDelCarrito(${index})">âœ–</span>
                        </div>
                    </div>
                `;
            });

            contador.innerText = `${carrito.length} productos`;
            total.innerText = `${totalCalc.toFixed(2)} â‚¬`;

            if(carrito.length === 0) {
                btn.disabled = true;
                btn.style.opacity = "0.5";
                btn.innerText = "Selecciona productos";
            } else {
                btn.disabled = false;
                btn.style.opacity = "1";
                btn.innerText = `Enviar a Cocina (${totalCalc.toFixed(2)}â‚¬) ðŸš€`;
            }
        }

        // 5. ENVIAR DATOS (ESTRATEGIA GET FINAL)
        function enviarComanda() {
            const mesa = document.getElementById('numMesa').value;
            
            if(!mesa) { alert("âš ï¸ Por favor indica nÃºmero de mesa"); return; }
            if(carrito.length === 0) { alert("âš ï¸ El carrito estÃ¡ vacÃ­o"); return; }

            const btn = document.getElementById('btn-enviar');
            btn.innerText = "Enviando...";
            btn.disabled = true;
            btn.style.backgroundColor = "#9ca3af"; 

            // ============================================================
            // ðŸ‘‡ðŸ‘‡ PEGA AQUÃ TU URL (LA QUE TERMINA EN /exec) ðŸ‘‡ðŸ‘‡
            const scriptURL = "https://script.google.com/macros/s/AKfycbzOmI7m6OiimyaGX3iOo0JAP0T33ZWtn_Nd0OCwelva_XVFXNPlz6OjPuMqcj5VWL9a/exec"; 
            // ============================================================

            const datosAEnviar = {
                mesa: mesa,
                carrito: carrito
            };

            // Codificamos los datos para que viajen seguros en la URL
            const payload = encodeURIComponent(JSON.stringify(datosAEnviar));
            const urlFinal = scriptURL + "?datos=" + payload;

            fetch(urlFinal, {
                method: "GET",
                mode: "no-cors"
            })
            .then(() => {
                alert(`âœ… Pedido enviado a Mesa ${mesa}`);
                carrito = [];
                actualizarTicket();
            })
            .catch(error => {
                console.error('Error:', error);
                alert("âŒ Error al enviar. IntÃ©ntalo de nuevo.");
            })
            .finally(() => {
                btn.innerText = "Selecciona productos";
                btn.style.backgroundColor = "";
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>
